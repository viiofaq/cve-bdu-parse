import psycopg2

with open("settings.txt", 'r') as fp:
    txt_lines = [1, 4, 7, 10, 13]
    lines = []
    for i, line in enumerate(fp):
        if i in txt_lines:
            lines.append(line.strip())


dbname = lines[0]
user = lines[1]
password = lines[2]
host = lines[3]

conn = psycopg2.connect(dbname=dbname, user=user,
                        password=password, host=host)
cursor = conn.cursor()

"""
cursor.execute(f"SELECT 1 FROM pg_catalog.pg_database WHERE datname = '{dbname}'")
exists = cursor.fetchone()

if not exists:
    cursor.execute(f'CREATE DATABASE {dbname}')
"""
commands = (
    """
    CREATE TABLE bdulist  (
        bduid TEXT ,
        datepublished TEXT ,
        cvss TEXT ,
        software TEXT ,
        softwareversion TEXT ,
        description TEXT ,
        cwe TEXT ,
        links TEXT ,
        otherids TEXT 
    )
    """,
    """ 
    CREATE TABLE cvelist (
        cveid TEXT ,
        datepublished TEXT ,
        cvss TEXT ,
        software TEXT ,
        softwareversion TEXT ,
        description TEXT ,
        cwe TEXT ,
        links TEXT 
            )
    """,
    """
    CREATE TABLE summarinfo (
        identificator TEXT ,
        otherids TEXT ,
        datepublished TEXT ,
        cvss TEXT ,
        software TEXT ,
        softwareversion TEXT ,
        description TEXT ,
        cwe TEXT ,
        links TEXT
    )
    """,
    """
    CREATE TABLE senddone (
        sendedid TEXT 
    )
    
    """,
    """
    CREATE TABLE mails (
        emails TEXT 
    )
    """,
    """
    CREATE TABLE chatlist (
        chatid TEXT 
    )
    """
)

try:
    for command in commands:
        cursor.execute(command)
except (psycopg2.DatabaseError, Exception) as error:
    print(error)

conn.commit()
cursor.close()
conn.close()
